<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA çƒå“¡å¡è¨‚è³¼é </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- å¼•å…¥ UNICONS åœ–æ¨™åº« -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <!-- å¼•å…¥ Swiper CSSï¼Œç”¨æ–¼æ»‘å‹•æ•ˆæœ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">

    <!-- å¼•å…¥åœ–è¡¨ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <style>
        /*å¢åŠ ç”¢å“è¢«é¸æ“‡æ™‚çš„æ˜é¡¯ç‹€æ…‹*/
        .prod-card.selectd {
            border-color: #28a745 !important;
            border-width: 3px !important;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.3);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }

        .prod-card {
            width: 18rem;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .prod-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .prod-card .card-img-top {
            height: 250px;
            object-fit: cover;
        }
        
        /* ä»˜æ¬¾æ–¹å¼æ¨£å¼ */
        .payment-option {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .payment-option:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .payment-option.selected {
            border-color: #28a745;
            background-color: #d4edda;
        }
        
        .payment-check {
            margin: 0;
        }
        
        .payment-label {
            width: 100%;
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }
        
        .form-check-input:checked ~ .payment-label {
            color: #28a745;
        }
    </style>
</head>

<body>
    <form id="orderform" class="needs-validation" novalidate>
        <!--ç”¢å“è³‡è¨Šå€å¡ŠåŠé é¢æ¨™é¡Œ-->
        <section class="container mt-4">
            <h1 class="text-center">NBA çƒå“¡å¡è¨‚è³¼é </h1>

            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <strong>æé†’ï¼š</strong> è«‹ç¢ºèªä»¥ä¸‹æ¬„ä½æ˜¯å¦æ­£ç¢ºã€‚
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="é—œé–‰"></button>
            </div>
            <div class="card">
                <div class="card-header">
                    <h4>é¸æ“‡ç”¢å“</h4>
                </div>
                <div class="card-body">
                    <div class="row justify-content-center">
                        <!-- ç”¢å“1 -->
                        <div class="col-12 col-md-4 d-flex justify-content-center mb-4">
                            <div class="card prod-card border border-dark"
                                onclick="selectProduct(this, 'product1', 1100 )">
                                <img class="card-img-top" src="assets/curry.jpg" alt="Stephen Curry">
                                <div class="card-body">
                                    <!--ç”¢å“æ¨™é¡Œ-->
                                    <div class="d-flex justify-content-between align-items-center mt-1 mb-2">
                                        <h5 class="prod_title">Stephen Curry</h5>
                                        <span class="badge bg-danger">ç†±é–€</span>
                                    </div>
                                    <p class="card-text">NBA çƒå“¡å¡</p>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>NT 1100</span>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" id="product1" name="product"
                                                value="Stephen Curry">
                                            <label for="product1" class="form-check-label">é¸æ“‡</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ç”¢å“2 -->
                        <div class="col-12 col-md-4 d-flex justify-content-center mb-4">
                            <div class="card prod-card border border-dark"
                                onclick="selectProduct(this, 'product2', 1000 )">
                                <img class="card-img-top" src="assets/durant.jpg" alt="Kevin Durant">
                                <div class="card-body">

                                    <!--ç”¢å“æ¨™é¡Œ-->
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h5 class="prod_title">Kevin Durant</h5>
                                        <span class="badge bg-success">ç†±é–€</span>
                                    </div>
                                    <p class="card-text">NBA çƒå“¡å¡</p>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>NT 1000</span>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" id="product2" name="product"
                                                value="Kevin Durant">
                                            <label for="product2" class="form-check-label">é¸æ“‡</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ç”¢å“3 -->
                        <div class="col-12 col-md-4 d-flex justify-content-center mb-4">
                            <div class="card prod-card border border-dark"
                                onclick="selectProduct(this, 'product3', 1200 )">
                                <img class="card-img-top" src="assets/lebron.jpg" alt="LeBron James">
                                <div class="card-body">
                                    <!--ç”¢å“æ¨™é¡Œ-->
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h5 class="prod_title">LeBron James</h5>
                                        <span class="badge bg-warning">ç†±é–€</span>
                                    </div>
                                    <p class="card-text">NBA çƒå“¡å¡</p>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>NT 1200</span>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" id="product3" name="product"
                                                value="LeBron James">
                                            <label for="product3" class="form-check-label">é¸æ“‡</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-check mt-1">
                        <input type="checkbox" class="form-check-input" id="warranty">
                        <label for="warranty" class="form-check-lable">æ·»åŠ å»¶é•·ä¿å›ºæœå‹™(+NT $199)</label>
                    </div>
                </div>
            </div>

        </section>
        <!--æ¶ˆè²»è€…è³‡è¨Š-->
        <section class="container mt-4">
            <div class="row">
                <div class="col-12 col-md-6">
                    <div class="card">
                        <div class="card-header">å®¢æˆ¶è³‡è¨Š</div>
                        <div class="card-body">
                            <div class="cname-div">
                                <label for="cname" class="form-check-label">è³¼è²·äººå§“å</label>
                                <input id="cname" name="canme" class="form-control" required>
                                <div class="invalid-feedback">
                                    è«‹è¼¸å…¥æ‚¨çš„å§“å
                                </div>
                            </div>
                            <div class="cemail-div mt-2">
                                <label for="cemail" class="form-check-label">è³¼è²·äººé›»éƒµ</label>
                                <input id="cemail" name="cemail" class="form-control" required>
                                <div class="invalid-feedback">
                                    è«‹è¼¸å…¥æ‚¨çš„email
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="card">
                        <div class="card-header">é…é€è³‡è¨Š</div>
                        <div class="card-body">
                            <div class="city-div">
                                <!-- ç¸£å¸‚ -->
                                <label for="ccity" class="form-check-label">ç¸£å¸‚</label>
                                <select class="form-select" id="ccity" name="ccity" required>
                                    <option value="">---è«‹é¸æ“‡---</option>
                                    <option value="å°åŒ—å¸‚">å°åŒ—å¸‚</option>
                                    <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                                    <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option>
                                    <option value="å°ä¸­å¸‚">å°ä¸­å¸‚</option>
                                </select>
                                <div class="invalid-feedback">
                                    è«‹è¼¸å…¥æ‚¨çš„ç¸£å¸‚
                                </div>
                            </div>
                            <div class="district-div mt-2">
                                <!-- è¡Œæ”¿å€åŸŸ -->
                                <label for="cdistrict" class="form-check-label">è¡Œæ”¿å€åŸŸ</label>
                                <input id="cdistrict" name="cdistrict" class="form-control" required>
                                <div class="invalid-feedback">
                                    è«‹è¼¸å…¥æ‚¨çš„è¡Œæ”¿å€åŸŸ
                                </div>
                            </div>
                            <div class="caddr-div mt-2">
                                <!-- åœ°å€ -->
                                <label for="caddr" class="form-check-label">åœ°å€</label>
                                <input id="caddr" name="caddr" class="form-control" required>
                                <div class="invalid-feedback">
                                    è«‹è¼¸å…¥æ‚¨çš„åœ°å€
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--ä»˜æ¬¾æ–¹å¼-->
        <section class="container mt-4">
            <div class="card">
                <div class="card-header">æ”¯ä»˜æ–¹å¼</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <h5 class="mb-3">é¸æ“‡ä»˜æ¬¾æ–¹å¼</h5>
                            
                            <!-- ä¿¡ç”¨å¡ -->
                            <div class="payment-option mb-3">
                                <div class="form-check payment-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="creditcard"
                                        value="creditcard" required>
                                    <label class="form-check-label payment-label" for="creditcard">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>ğŸ’³ ä¿¡ç”¨å¡/Debitå¡</strong>
                                                <div class="text-muted small">æ”¯æ´ Visaã€MasterCardã€JCB</div>
                                            </div>
                                            <span class="text-success small">æ¨è–¦</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- LINE Pay -->
                            <div class="payment-option mb-3">
                                <div class="form-check payment-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="linepay" value="linepay">
                                    <label class="form-check-label payment-label" for="linepay">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>ğŸ’š LINE Pay</strong>
                                                <div class="text-muted small">ä½¿ç”¨ LINE Pay å¿«é€Ÿä»˜æ¬¾</div>
                                            </div>
                                            <span class="text-primary small">ä¾¿åˆ©</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- ATM è½‰å¸³ -->
                            <div class="payment-option mb-3">
                                <div class="form-check payment-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="atm" value="atm">
                                    <label class="form-check-label payment-label" for="atm">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>ğŸ§ ATM è½‰å¸³</strong>
                                                <div class="text-muted small">æ‰‹çºŒè²» +NT$20ï¼Œ3å¤©å…§å®Œæˆè½‰å¸³</div>
                                            </div>
                                            <span class="text-info small">+$20</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- è²¨åˆ°ä»˜æ¬¾ -->
                            <div class="payment-option mb-3">
                                <div class="form-check payment-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod">
                                    <label class="form-check-label payment-label" for="cod">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>ğŸ“¦ è²¨åˆ°ä»˜æ¬¾</strong>
                                                <div class="text-muted small">æ”¶åˆ°å•†å“æ™‚ç¾é‡‘ä»˜æ¬¾</div>
                                            </div>
                                            <span class="text-warning small">+$30</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="invalid-feedback">
                        è«‹è¼¸å…¥æ‚¨çš„æ”¯ä»˜æ–¹å¼
                    </div>
                </div>
            </div>
        </section>
        <!--è¨‚å–®æ˜ç´°-->
        <section class="container mt-4">
            <div class="card">
                <div class="card-header">è¨‚å–®æ‘˜è¦</div>
                <div class="card-body">
                    <div class="order-summary">
                        <div class="row mt-2">
                            <div class="col-7">ç”¢å“</div>
                            <div class="col-5 text-end" id="productName">xyz</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-7">åƒ¹æ ¼</div>
                            <div class="col-5 text-end" id="productPrice">NT$0</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-7">å»¶é•·ä¿å›ºè²»ç”¨</div>
                            <div class="col-5 text-end" id="warrantyPrice">NT$0</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-7">é‹è²»</div>
                            <div class="col-5 text-end" id="shippingPrice">NT$0</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-7">ä»˜æ¬¾æ‰‹çºŒè²»</div>
                            <div class="col-5 text-end">NT$0</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-7">ç¸½è¨ˆ</div>
                            <div class="col-5 text-end" id="totalPrice">NT$0</div>
                        </div>
                    </div>
                    <div class="form-check mt-2">
                        <input type="checkbox" class="form-check-input" id="term" name="term" required>
                        <label for="term" class="form-check-label">
                            æˆ‘å·²é–±è®€ä¸”åŒæ„<a href="javascript:;">æœå‹™æ¢æ¬¾</a>åŠ<a href="javascript:;">éš±ç§æ”¿ç­–</a>
                        </label>
                        <div class="invalid-feedback">æ‚¨å¿…é ˆåŒæ„æ‰èƒ½é€²è¡Œçµå¸³.</div>
                    </div>
                    <div class="mt-2 d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">çµå¸³</button>
                    </div>
                </div>

            </div>
            </div>
        </section>

    </form>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        //å…¨åŸŸè®Šæ•¸
        let selectedProductPrice = 0;

        function selectProduct(cardEl, pid, price) {
            // å…ˆé‚„åŸæ¯å€‹ç”¢å“å¡ç‰‡çš„é¸å–ç‹€æ…‹
            document.querySelectorAll('.prod-card').forEach(card => {
                card.classList.remove('selectd', 'border-success');
                card.classList.add('border-dark');
            });
            // è¢«é¸åˆ°çš„å¡ç‰‡åŠ ä¸Šç¶ è‰²é‚Šæ¡†
            cardEl.classList.add("selectd", "border-success");
            cardEl.classList.remove("border-dark");
            document.getElementById(pid).checked = true;
            document.getElementById("productName").textContent = document.getElementById(pid).value;
            document.getElementById("productPrice").textContent = `NTD$${price}`;
            selectedProductPrice = price;
            updateTotal();
        }
        //è¨ˆç®—ç¸½é‡‘é¡
        function updateTotal() {
            let warranty = document.getElementById("warranty").checked; // å–å¾—ä¿å›ºå‹¾é¸ç‹€æ…‹
            let warrantyPrice = warranty ? 199 : 0; // ä¿å›ºé‡‘é¡

            let payment_fee = 0;
            let paymentMethod = document.querySelector("input[name=paymentMethod]:checked");
            if (paymentMethod) {
                if (paymentMethod.value == 'cod') {
                    payment_fee = 30;
                } else if (paymentMethod.value == 'atm') {
                    payment_fee = 20;
                }
            }

            document.getElementById("warrantyPrice").textContent = `NT$${warrantyPrice}`;
            document.getElementById("shippingPrice").textContent = `NT$${payment_fee}`;

            let totalPrice = selectedProductPrice + warrantyPrice + payment_fee;
            document.getElementById("totalPrice").textContent = `NT$${totalPrice}`;
        }

        document.querySelectorAll("input[name=paymentMethod]").forEach(obj => {
            obj.addEventListener("change", function() {
                // æ›´æ–°ç¸½é‡‘é¡
                updateTotal();
                
                // æ›´æ–°è¦–è¦ºæ•ˆæœ
                document.querySelectorAll('.payment-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                if (this.checked) {
                    this.closest('.payment-option').classList.add('selected');
                }
            });
        });
        
        // ç‚ºä»˜æ¬¾é¸é …æ·»åŠ é»æ“Šäº‹ä»¶
        document.querySelectorAll('.payment-option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                    radio.dispatchEvent(new Event('change'));
                }
            });
        });
        
        document.getElementById("warranty").addEventListener("change", updateTotal);
        
        // ç¶ ç•Œé‡‘æµæäº¤è™•ç†
        function submitToEcpay() {
            const form = document.getElementById('orderform');
            const formData = new FormData(form);
            
            // å–å¾—æ‰€é¸ç”¢å“è³‡è¨Š
            const selectedProduct = document.querySelector("input[name=product]:checked");
            if (!selectedProduct) {
                alert('è«‹é¸æ“‡ç”¢å“');
                return false;
            }
            
            // å–å¾—ä»˜æ¬¾æ–¹å¼
            const paymentMethod = document.querySelector("input[name=paymentMethod]:checked");
            if (!paymentMethod) {
                alert('è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼');
                return false;
            }
            
            // æº–å‚™é€åˆ°å¾Œç«¯çš„è³‡æ–™
            const orderData = {
                productName: selectedProduct.value,
                productPrice: selectedProductPrice,
                warranty: document.getElementById("warranty").checked,
                customerName: document.getElementById("cname").value,
                customerEmail: document.getElementById("cemail").value,
                city: document.getElementById("ccity").value,
                district: document.getElementById("cdistrict").value,
                address: document.getElementById("caddr").value,
                paymentMethod: paymentMethod.value
            };
            
            // é™¤éŒ¯ç”¨ï¼šé¡¯ç¤ºå³å°‡ç™¼é€çš„è³‡æ–™
            console.log('æº–å‚™ç™¼é€çš„è¨‚å–®è³‡æ–™:', orderData);
            
            // é©—è­‰å¿…è¦æ¬„ä½
            if (!orderData.productName || !orderData.productPrice || !orderData.customerName || !orderData.customerEmail) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½');
                return false;
            }
            
            // é€åˆ°å¾Œç«¯å»ºç«‹ç¶ ç•Œè¨‚å–®
            fetch('/api/create-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(orderData)
            })
            .then(response => {
                // æª¢æŸ¥å›æ‡‰ç‹€æ…‹
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // æª¢æŸ¥ Content-Type ä¾†åˆ¤æ–·æ˜¯ HTML é‚„æ˜¯ JSON
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    // å¦‚æœæ˜¯ JSONï¼Œè¡¨ç¤ºæœ‰éŒ¯èª¤
                    return response.json().then(data => {
                        throw new Error(data.error || 'è¨‚å–®å»ºç«‹å¤±æ•—');
                    });
                } else {
                    // å¦‚æœæ˜¯ HTMLï¼Œæ­£å¸¸è™•ç†
                    return response.text();
                }
            })
            .then(html => {
                // å°‡ç¶ ç•Œçš„è¡¨å–®æ’å…¥é é¢ä¸¦è‡ªå‹•æäº¤
                document.body.innerHTML = html;
            })
            .catch(error => {
                console.error('Error:', error);
                alert('è¨‚å–®å»ºç«‹å¤±æ•—ï¼š' + error.message);
            });
            
            return false;
        }

        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault(); // é˜»æ­¢é è¨­æäº¤
                        
                        if (!form.checkValidity()) {
                            //å¦‚æœè¡¨å–®é€éhtml5åŸç”Ÿé©—è¨¼å¤±æ•—çš„æƒ…æ³ä¸‹
                            event.stopPropagation();
                        } else {
                            //å¦‚æœè¡¨å–®é€éhtml5åŸç”Ÿé©—è¨¼æˆåŠŸçš„æƒ…æ³ä¸‹
                            // å‘¼å«ç¶ ç•Œé‡‘æµæäº¤å‡½æ•¸
                            submitToEcpay();
                        }

                        form.classList.add('was-validated')
                    }, false)
                })
        })()
    </script>
</body>

</html>